<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>破冰赢手机</title>
  <link rel="stylesheet" type="text/css" href="css/icebreakingStyle.css" />
</head>

<body>
  <div class="warp">
  <!-- 左边导航-->
    <div class="left left_shop Yahei">
        <div class="navBox">
            <a class=""  href=""><span class="icon_hammer"></span>破冰赢手机</a>
        </div>
    </div>
    <!--左边end-->

    <div class="right">
      <div class="ice_01"></div>
      <div class="ice_02">
        <a class="btn_myPrize"></a>
        <div class="ice_container">
          <div class="hammer">
            <a class="btn_hammer" id="btn_hammer"></a>
            <p>破冰锤: 8888个</p>
          </div>
          <ul>
            <li class="item1">
              <img src="./images/icebreaking/ice_bg.png" class="ice_bg">
              <img class="smash" src="./images/icebreaking/smash.png">
              <div class="item_inner coin1">
                <span class="icon_prize"></span>
                <div class="txt">
                  <p>1000~10万</p>
                  <p>积分</p>
                </div>
              </div>
            </li>
            <li class="item2 ">
              <img src="./images/icebreaking/ice_bg.png" class="ice_bg">
              <img class="smash" src="./images/icebreaking/smash.png">
              <!-- <i class=""></i> -->
              <div class="item_inner hongbao">
                <span class="icon_prize"></span>
                <div class="txt">
                  <p>1~100元</p>
                  <p>红包</p>
                </div>
              </div>
            </li>
            <li class="item3">
              <img src="./images/icebreaking/ice_bg.png" class="ice_bg">
              <img class="smash" src="./images/icebreaking/smash.png">
              <div class="item_inner bag1">
                <span class="icon_prize"></span>
                <div class="txt">
                  <p>x 1</p>
                  <p>游戏福袋</p>
                </div>
              </div>
            </li>
            <li class="item4">
              <img src="./images/icebreaking/ice_bg.png" class="ice_bg">
              <img class="smash" src="./images/icebreaking/smash.png">
              <div class="item_inner iPad">
                <span class="icon_prize"></span>
                <div class="txt">
                  <p>iPad mini4</p>
                  <p>128G</p>
                </div>
              </div>
            </li>
            <li class="item5">
              <img src="./images/icebreaking/ice_bg.png" class="ice_bg">
              <img class="smash" src="./images/icebreaking/smash.png">
              <div class="item_inner coin2">
                <span class="icon_prize"></span>
                <div class="txt">
                  <p>1万~100万</p>
                  <p>积分</p>
                </div>
              </div>
            </li>
            <li class="item6">
              <img src="./images/icebreaking/ice_bg.png" class="ice_bg">
              <img class="smash" src="./images/icebreaking/smash.png">
              <div class="item_inner card">
                <span class="icon_prize"></span>
                <div class="txt">
                  <p>500元京东卡</p>
                </div>
              </div>
            </li>
            <li class="item7">
              <img src="./images/icebreaking/ice_bg.png" class="ice_bg">
              <img class="smash" src="./images/icebreaking/smash.png">
              <div class="item_inner bag2">
                <span class="icon_prize"></span>
                <div class="txt">
                  <p>x 1</p>
                  <p>游戏福袋</p>
                </div>
              </div>
            </li>
            <li class="item8">
              <img src="./images/icebreaking/ice_bg.png" class="ice_bg">
              <img class="smash" src="./images/icebreaking/smash.png">
              <i class=""></i>
              <div class="item_inner iPhone">
                <span class="icon_prize"></span>
                <div class="txt">
                  <p>iPhone X</p>
                  <p>256G</p>
                </div>
              </div>
            </li>
          </ul>
        </div>

        <div class="rule">
          <h3><img src="images/icebreaking/icon_book.png"/>破冰秘籍</h3>
          <div class="rule_txt">
            <p>1.累计赢满30万送1个破冰锤，每局最多送1个</p>
            <p>2.每日最多可获得20个破冰锤</p>
            <p>3.捕鱼游戏、奖品斗地主、欢乐斗地主、决战、吹牛、万人拼十（抢庄场、双旦大战房、贵宾厅）、二人麻将、新三公、新十三水、血流成河参与此活动 </p>
          </div>
        </div>

        <div class="broadcast">
          <div class="rollCon1">
            <ul>
              <li>豆子薛之谦豆子薛之谦豆子薛之谦18:59抽中iPhoneX 256G</li>
              <li>豆子薛之谦18:59抽中iPhoneX 256G</li>
              <li>豆子薛之谦18:59抽中iPhoneX 256G</li>
              <li>豆子薛之谦18:59抽中iPhoneX 256G</li>
              <li>豆子薛之谦18:59抽中iPhoneX 256G</li>
              <li>豆子薛之谦18:59抽中iPhoneX 256G</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="bg" style="display: none;"></div>

    <!-- 中奖记录 -->
    <div class="diaBox box_jilu" id="recordBox" style="display: none; ">
      <div class="dia_header Yahei"> <a class="dia_close pop_close"></a><img src="images/icebreaking/zhong_jilu.png"> </div>
      <div class="dia_body" id="myPrizeContent">
        <table cellpadding="0" cellspacing="0" class="jaingpin_tb">
          <tr>
            <th width="15%">排名</th>
            <th width="15%">时间</th>
            <th width="50%">奖励</th>
            <th width="20%">状态</th>
          </tr>
          <tr>
            <td>2</td>
            <td>12.20 </td>
            <td class="red">500个雪人（价值5000元）</td>
            <td><a class=""></a>已发放</td>
          </tr>
          <tr class="tr">
            <td>2</td>
            <td>12.20 </td>
            <td class="red">500个雪人（价值5000元）</td>
            <td><a class="btn_lingquSmall"></a></td>
          </tr>
          <tr>
            <td>2</td>
            <td>12.20 </td>
            <td class="red">500个雪人（价值5000元）</td>
            <td><a class=""></a>已发放</td>
          </tr>
          <tr class="tr">
            <td>2</td>
            <td>12.20 </td>
            <td class="red">500个雪人（价值5000元）</td>
            <td><a class="btn_lingquSmall"></a></td>
          </tr>
          <tr>
            <td>2</td>
            <td>12.20 </td>
            <td class="red">500个雪人（价值5000元）</td>
            <td><a class=""></a>已发放</td>
          </tr>
        </table>
        <div class="pages">
          <a class="active">上一页</a> <span class="page_num">1</span> <span class="page_num1">2</span><a class="active">下一页</a>
        </div>
      </div>
    </div>

    <!--抱歉次数用完 -->
    <div class="diaBox sorryBox" style="display: none;">
      <div class="dia_header Yahei"><a class="dia_close pop_close"></a></div>
      <div class="dia_body">
        <div class="tishi">
          <p class="rule">亲，您今天的抽奖次数已用完！</p>
        </div>
        <div class="btnAgain">
          <p>万人拼十双旦大战房每日壕送万元奖励</p>
          <a></a>
        </div>
      </div>
    </div>

    <!--抱歉条件不足 -->
    <div class="diaBox sorryBox tiaoJianBox" style="display: none;">
      <div class="dia_header Yahei"><a class="dia_close pop_close"></a></div>
      <div class="dia_body">
        <p class="rule tishi">亲，您还未达成抽奖条件噢！</p>
        <div class="btnAgain">
            <p>再赢199999积分就能抽奖啦！</p>
          <a></a>
        </div>
      </div>
    </div>

    <!--奖品物品-->
    <div class="diaBox prizeBox goodsBox" style="display: none;">
      <div class="diaBox_inner">
        <div class="dia_header Yahei"><a class="dia_close pop_close"></a><img src="images/icebreaking/gongxi_title.png"></div>
        <div class="dia_body">
          <p class="rule tishi">获得 <span>10个“圣诞铃铛”<br />（价值10元）</span></p>
          <div class="btnAgain">
            <p>可在万人拼十双旦大战中代替积分消耗</p>
            <a></a>
          </div>
        </div>
      </div>
    </div>

    <!--奖品红包-->
    <div class="diaBox prizeBox hongbaoBox" style="display: none;">
      <div class="diaBox_inner">
        <div class="dia_header Yahei"><a class="dia_close pop_close"></a><img src="images/icebreaking/gongxi_title.png"></div>
        <div class="dia_body">
          <p class="rule tishi">获得 <span>100元红包</span><br />红包已添加至您红包余额</p>
          <div class="btnAgain">
            <p>万人拼十双旦大战房每日壕送万元奖励</p>
            <a></a>
          </div>
        </div>
      </div>
    </div>

    <!--奖品积分-->
    <div class="diaBox prizeBox pointBox" style="display: none;">
      <div class="diaBox_inner">
        <div class="dia_header Yahei"><a class="dia_close pop_close"></a><img src="images/icebreaking/gongxi_title.png"></div>
        <div class="dia_body">
          <p class="rule tishi">获得 <span>100000积分</span><br />积分已添加至您账号上</p>
          <div class="btnAgain">
            <p>万人拼十双旦大战房每日壕送万元奖励</p>
            <a></a>
          </div>
        </div>
      </div>
    </div>

<!--  恭喜弹窗
    <div class="diaBox gongxi" style="display: none">
      <div class="diaBox_inner">
        <div class="dia_header Yahei"><a class="dia_close pop_close"></a><img src="images/icebreaking/gongxi_title.png"></div>
        <div class="dia_body">
          <p class="rule tishi">获得 <span>价值100元的 </span></p>
          <div class="card_socks" id="card_gift">
            <div class="icon_bg"></div>
            <p class="number">x100</p>
            <p class="gift_name">圣诞袜</p>
          </div>
          <div class="btnAgain">
            <p>可在双旦大作战游戏中代替积分消耗</p>
            <a class="btn_liangjiang"></a>
          </div>
        </div>
      </div>
    </div>
 -->
  </div>

  <script src="js/jquery-1.8.3.min.js"></script>
  <script>
  //polyfill Array.prototype.indexOf
  if (!Array.prototype.indexOf) {
    Array.prototype.indexOf = function(searchElement, fromIndex) {
      var k;
      if (this == null) {
        throw new TypeError('"this" is null or not defined');
      }

      var O = Object(this);
      var len = O.length >>> 0;
      if (len === 0) {
        return -1;
      }

      var n = +fromIndex || 0;
      if (Math.abs(n) === Infinity) {
        n = 0;
      }
      if (n >= len) {
        return -1;
      }

      k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);
      while (k < len) {
        if (k in O && O[k] === searchElement) {
          return k;
        }
        k++;
      }
      return -1;
  };
}
  </script>
  <script>
  $(function(){
    scale()
    $('#btn_hammer').on('click', startShuffle)
  })

  function scale(){
    var widthMax = $('.ice_container li>.smash').width() * 1
    var widthMin = $('.ice_container li>.smash').width() * 0.9
    var heightMax = $('.ice_container li>.smash').height() * 1
    var heightMin = $('.ice_container li>.smash').height() * 0.9
    window.setInterval(function(){
      $('.smashOn').animate({
        width: widthMin,
        height: heightMin
      }, 500).animate({
        width: widthMax,
        height: heightMax
      }, 500)
    }, 1000)
  }

  function startShuffle(){
    $('#btn_hammer').unbind()
    $('.hammer').hide()
    $('.icon_prizeOn').removeClass('icon_prizeOn')
    $('.ice_container .ice_bg').removeClass('ice_bgOn').attr('src','./images/icebreaking/ice_bg.png')
    //将牌集合到一处
    window.setTimeout(function() {
      sort()
    }, 500)

    // 洗牌次数
    window.setTimeout(function() {
      for (var j = 0; j < 10; j++) {
        if (j === 3) $('.ice_container .item_inner').remove()
        shuffle()
      }
      sort()
    }, 1000)

    //发牌
    window.setTimeout(function() {
      poker()
      window.setTimeout(function(){
        $('.ice_container li').click(flip)
        $('.ice_container .smash').addClass('smashOn')
      }, 500)
      window.setTimeout(function(){$('.hammer').show()}, 500)
    }, 1500)
  }

  //翻牌
  function flip(){
    var url = './images/icebreaking/ice_breaking.gif?version=' + Math.floor(Math.random() * 100000000),
      self = this
    $('.ice_container li').unbind()
    $('.ice_container .smash').removeClass('smashOn')
    $(this).append(getGif(url, 'ice_bg gif', function(){showPrize.call(this,self)}))

    function showPrize(self){
      $(self).find('.ice_bg').not('.gif').remove()
      this.onload = null
      window.setTimeout(function(){
        var prizeName = ['coin1', 'hongbao', 'bag1', 'iPad', 'coin2', 'card', 'bag2', 'iPhone']
        var htmlObject = getHTML()
        //key 是从后台传过来的
        var key = "coin1"
        var $html = $(htmlObject[key]).find('.icon_prize').addClass('icon_prizeOn').end()
        var $cardList = $(self).siblings()

        prizeName.splice(prizeName.indexOf(key), 1)
        $(self).find('.gif').removeClass('gif').addClass('ice_bgOn').attr('src', './images/icebreaking/ice_bgOn.png').end().append($html)
        for (var i = 0; i < $cardList.length; i++){
          var object = spliceArray(prizeName)
          prizeName = object.array
          html = htmlObject[object.item]
          !function(j,nhtml){
            window.setTimeout(function(){
              $($cardList[j]).append(nhtml)
              if(j === 6){
                $('#btn_hammer').click(startShuffle)
              }
            }, 500)
          }(i,html)
        }
      }, 800)
    }
  }

  //发牌
  function poker() {
    var position = {
        item1: { top: 0, left: 0 },
        item2: { top: 0, left: 113 },
        item3: { top: 0, left: 227 },
        item4: { top: 101, left: 227 },
        item5: { top: 202, left: 227 },
        item6: { top: 202, left: 113 },
        item7: { top: 202, left: 0 },
        item8: { top: 101, left: 0 }
      },
      timeout = 100
    for (var i = 1; i < 9; i++) {
      var className = 'item' + i
      $('.' + className).animate({
        top: position[className].top,
        left: position[className].left,
        'z-index': 1
      }, timeout)
      timeout += 10
    }
  }

  //洗牌
  function shuffle() {
    var $cardList = $('.ice_container li'),
      zIndexList = [1, 2, 3, 4, 5, 6, 7, 8 ]
    for (var j = 0; j < $cardList.length; j++) {
      var zIndex = spliceArray(zIndexList).index
      var left = window.Math.random() < 0.5 ? 100 + window.Math.floor(30 * window.Math.random()) : 100 - window.Math.floor(30 * window.Math.random())
      var top = window.Math.random() < 0.5 ? 90 + window.Math.floor(30 * window.Math.random()) : 90 - window.Math.floor(30 * window.Math.random())
      var card = $cardList[j]
      $(card).animate({
        left: left,
        top: top,
        'z-index': zIndex
      }, 30)
    }
  }

  function spliceArray(array){
    var removeIndex = window.Math.floor(array.length * window.Math.random())
    var removeItem = array[removeIndex]
    array.splice(removeIndex, 1)
    return {array: array, index: removeIndex, item: removeItem}
  }

  // 洗牌结束后将牌集中一处
  function sort() {
    var $cardList = $('.ice_container li'),
      timeout = 100,
      top = 90,
      left = 100

    for (var i = 0; i < $cardList.length; i++) {
      $($cardList[i]).animate({
        top: top,
        left: left,
        opacity: 1
      }, timeout, 'swing')
      timeout += 50
      top -= 1
      left -= 1
    }
  }

  function getGif(url, className, callback){
    var image = new Image()
    $(image).addClass(className)
    image.onload = callback
    image.src = url
    return image
  }

  function getHTML(){
    return {
      coin1: '<div class="item_inner coin1"> <span class="icon_prize"></span> <div class="txt"> <p>1000~10万</p> <p>积分</p> </div> </div> ',
      hongbao: '<div class="item_inner hongbao"> <span class="icon_prize"></span> <div class="txt"> <p>1~100元</p> <p>红包</p> </div> </div> ',
      bag1:'<div class="item_inner bag1"> <span class="icon_prize"></span> <div class="txt"> <p>x 1</p> <p>游戏福袋</p> </div> </div> ',
      iPad: '<div class="item_inner iPad"> <span class="icon_prize"></span> <div class="txt"> <p>iPad mini4</p> <p>128G</p> </div> </div> ',
      coin2: '<div class="item_inner coin2"> <span class="icon_prize"></span> <div class="txt"> <p>1万~100万</p> <p>积分</p> </div> </div> ',
      card: '<div class="item_inner card"> <span class="icon_prize"></span> <div class="txt"> <p>500元京东卡</p> </div> </div> ',
      bag2: '<div class="item_inner bag2"> <span class="icon_prize"></span> <div class="txt"> <p>x 1</p> <p>游戏福袋</p> </div> </div> ',
      iPhone: '<div class="item_inner iPhone"> <span class="icon_prize"></span> <div class="txt"> <p>iPhone X</p> <p>256G</p> </div> </div> '
    }
  }
  </script>
</body>

</html>
