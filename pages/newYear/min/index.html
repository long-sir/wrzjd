<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>赢分旺财</title>
  <link rel="stylesheet" type="text/css" href="css/style.css" />
</head>

<body>
  <div class="warp">
    <!-- 左边导航-->
    <div class="left Yahei">
      <div class="navBox">
        <a class=""><span class="icon_05"></span>赢分旺财</a>
      </div>
    </div>
    <!--左边end-->
    <div class="right">
      <div class="dog_01">
        <div class="sangong_rol">
          <ul class="sangong_rol1" style="width: 1512px;">
            <li>张莉拆到<span>50元</span>旺旺大红包</li>
            <li>张莉拆到<span>50元</span>旺旺大红包</li>
            <li>张莉拆到<span>50元</span>旺旺大红包</li>
          </ul>
        </div>
      </div>
      <div class="dog_02">
        <a class="btn_rule btn_yellow">规则</a>
        <a class="btn_myRedBag btn_yellow">我的红包</a>
        <h3 class="money_total">总奖金 500000 元</h3>
        <ul class="redBag_container">
          <li class="redBag_01 opened">
            <div class="money_max"><span class="txt_max">最高</span>10<span class="dollar">元</span></div>
            <div class="redBag_txt"><i class="icon_dog"></i>好运旺红包</div>
            <a class="btn_openRedBag"></a>
            <div class="user_award">10.88<span class="dollar">元</span></span>
            </div>
          </li>
          <li class="redBag_02">
            <div class="money_max"><span class="txt_max">最高</span>50<span class="dollar">元</span></div>
            <div class="redBag_txt"><i class="icon_dog"></i>福运旺红包</div>
            <a class="btn_openRedBag"></a>
            <div class="user_award">20<span class="dollar">元</span></span>
            </div>
          </li>
          <li class="redBag_03 opened">
            <div class="money_max"><span class="txt_max">最高</span>100<span class="dollar">元</span></div>
            <div class="redBag_txt"><i class="icon_dog"></i>人丁旺红包</div>
            <a class="btn_openRedBag"></a>
            <div class="user_award">99.99<span class="dollar">元</span></span>
            </div>
          </li>
          <li class="redBag_04">
            <div class="money_max"><span class="txt_max">最高</span>500<span class="dollar">元</span></div>
            <div class="redBag_txt"><i class="icon_dog"></i>财运旺红包</div>
            <a class="btn_openRedBag"></a>
            <div class="user_award"><span class="dollar">元</span></span>
            </div>
          </li>
        </ul>
      </div>
      <div class="dog_03">
        <a class="btn_restart"></a>
        <div class="progress_bar">
          <div class="yellow_bar">
            <i class="before"></i>
            <span class="yellow_dot1 active"><i></i></span>
            <span class="yellow_dot2 active"><i></i></span>
            <span class="yellow_dot3 active"><i></i></span>
            <span class="yellow_dot4 active"><i></i></span>
            <i class="after"></i>
          </div>
        </div>
        <div class="point_total"><span class="txt_total">累计赢分:</span><span class="text-yellow">1888888/5000000</span> <span class="goal">(再赢5000积分开100元红包)</span></div>
      </div>
    </div>
    <div class="bg" style="display: none;"></div>

    <!-- 中奖记录 -->
    <div class="diaBox box_history" id="recordBox" style="display: none; ">
      <div class="dia_header Yahei"> <a class="close pop_close"></a><img src="images/newYear/history_title.png"> </div>
      <div class="dia_body" id="myPrizeContent">
        <table cellpadding="0" cellspacing="0" class="jaingpin_tb">
          <tr>
            <th width="35%">时间</th>
            <th width="45%">奖励</th>
            <th width="20%">状态</th>
          </tr>
          <tr>
            <td>12月20日18:18</td>
            <td class="red">99.99元</td>
            <td><a class=""></a>已发放</td>
          </tr>
          <tr class="tr">
            <td>12月20日18:18</td>
            <td class="red">99.99元</td>
            <td><a class=""></a>已发放</td>
          </tr>
          <tr>
            <td>12月20日18:18</td>
            <td class="red">99.99元</td>
            <td><a class=""></a>已发放</td>
          </tr>
          <tr class="tr">
            <td>12月20日18:18</td>
            <td class="red">99.99元</td>
            <td><a class=""></a>已发放</td>
          </tr>
          <tr>
            <td>12月20日18:18</td>
            <td class="red">99.99元</td>
            <td><a class=""></a>已发放</td>
          </tr>
        </table>
        <div class="pages">
          <a class="active">上一页</a> <span class="page_num">1</span> <span class="page_num1">2</span><a class="active">下一页</a>
        </div>
      </div>
    </div>

    <!-- 活动说明弹窗 -->
    <div class="diaBox box_rule" id="rule" style="display:none;" >
      <div class="dia_header Yahei"><a class="close pop_close"></a><img src="images/newYear/rule_title.png"></div>
      <div class="dia_body">
        <p class="rule_detail">1、累计赢分到10万、50万、100万、500万分别可开启10元、50元、100元、500元红包，赢分越高，红包越大；
          <br /> 2、4个红包都开启后，赢分将重新累计并消耗一轮次数；
          <br /> 3、活动中途可重新开始，赢分将重新累计并消耗一轮次数；
          <br /> 4、每轮可开4个红包，每个玩家每天最多可参与8轮活动；
          <br /> 5、斗地主、欢乐斗地主、三公、决战、新决战、麻将（血流成河、二人雀神）、万人拼十（抢庄场、大桌房、贵宾厅）、吹牛参与此活动
          <br /> 6、红包直接发放到红包余额中，可在“我的红包”查看明细。
          <br />
        </p>
      </div>
    </div>

    <!--抱歉条件不足 -->
    <div class="diaBox commonBox" style="display: none;">
      <div class="dia_header Yahei"><a class="close pop_close"></a></div>
      <div class="dia_body">
        <div class="prompt_txt">
          <p class="tishi">亲，您还未达成抽奖条件噢！</p>
        </div>
        <div class="btnAgain">
          <p>再赢9999999积分就能开新年红包啦！</p>
          <a class="btn_sure"></a>
        </div>
      </div>
    </div>

    <!--抱歉红包开完 -->
    <div class="diaBox commonBox" style="display: none;">
      <div class="dia_header Yahei"><a class="close pop_close"></a></div>
      <div class="dia_body">
        <div class="prompt_txt">
          <p class="tishi">亲，您今天的红包已全部开完！</p>
        </div>
        <div class="btnAgain">
          <p>新的一年祝您恭喜发财，财源滚滚噢！</p>
          <a class="btn_sure"></a>
        </div>
      </div>
    </div>

    <!-- 还有未拆完的红包 -->
    <div class="diaBox commonBox" style="display: none;">
      <div class="dia_header Yahei"><a class="close pop_close"></a></div>
      <div class="dia_body">
        <div class="prompt_txt">
          <p class="tishi">亲，您还有未拆开的新年红包！</p>
        </div>
        <div class="btnAgain">
          <p>全部拆开后才能重新开始噢！</p>
          <a class="btn_sure"></a>
        </div>
      </div>
    </div>

    <!-- 重新开始 -->
    <div class="diaBox commonBox" style="display: none;">
      <div class="dia_header Yahei"><a class="close pop_close"></a></div>
      <div class="dia_body">
        <div class="prompt_txt">
          <p class="tishi">亲，选择重新开始后，赢分将重新累计！</p>
        </div>
        <div class="btnAgain">
          <p>您确定要重新开始吗？</p>
          <a class="btn_sure"></a>
        </div>
      </div>
    </div>

    <!-- 恭喜对话框 -->
    <div class="diaBox gongxi" style="display: block">
      <div class="diaBox_inner">
        <div class="dia_header Yahei"><a class="close pop_close"></a><img src="images/newYear/gongxi_title.png"></div>
        <div class="dia_body">
          <div class="icon_redBagOn"></div>
          <p class="tishi">获得 <span class="red">99.99元新年红包</span></p>
          <div class="btnAgain">
            <p>新的一年祝您恭喜发财，财源滚滚噢！</p>
            <a class="btn_sureYellow"></a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript" src="../../../../public/jquery/jquery-1.8.3.min.js"></script>
  <script type="text/javascript" src="../../../../public/jquery/openPop.js"></script>
  <script type="text/javascript" src="../../../../public/jquery/rollOdao.js"></script>

  <script>
  //polyfill Array.prototype.indexOf
  if (!Array.prototype.indexOf) {
    Array.prototype.indexOf = function(searchElement, fromIndex) {
      var k;
      if (this == null) {
        throw new TypeError('"this" is null or not defined');
      }

      var O = Object(this);
      var len = O.length >>> 0;
      if (len === 0) {
        return -1;
      }

      var n = +fromIndex || 0;
      if (Math.abs(n) === Infinity) {
        n = 0;
      }
      if (n >= len) {
        return -1;
      }

      k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);
      while (k < len) {
        if (k in O && O[k] === searchElement) {
          return k;
        }
        k++;
      }
      return -1;
    };
  }
  </script>
  <script>
    $('.btn_rule').click(function(){
      $('.box_rule').openPop()
    })
    $('.btn_myRedBag').click(function(){
      $('.box_history').openPop()
    })
    $('.pop_close').click(function(){
      $('.diaBox').closePop()
    })

    //监听重新开始按钮
    $('.btn_restart').click(function(){
      $('.box_restart').openPop()
      //点击确定按钮
      $('.box_restart .btn_sure').click(function(){
        $(this).unbind()
        $('.box_restart').closePop()
      })
    })

    //redBagNumber第几个红包,格式为【1/2/3/4】
    //money为抽到的红包金额
    function openRedBag(redBagNumber, money){
      var selector = '.redBag_0' + redBagNumber + ' .btn_openRedBag'
      $('.redBag_02 .btn_openRedBag').click(function(event){
        $(this).unbind()
        $('.money',$(this).parent()).text(money)
        $(this).parent().addClass('opened')
      })
    }
    openRedBag(2, 12)

    //初始化红包
    //redBagNumber第几个红包,格式为【1/2/3/4】
    //如果opened 为true，那么必须传入money
    //如果opened 为false, 那么设置红包是没打开状态
    function initRedBag(redBagNumber, opened, money){
      var selector = '.redBag_0' + redBagNumber
      if(opened){
        $(selector).addClass('opened').find('.money').text(money)
      }else{
        $(selector).removeClass('opened').find('.money').text('')
      }
    }
    initRedBag(3)



    var pointArr = [100000, 500000, 1000000, 5000000]
    // var dotWidthRatio = 30/912
    var dotWidth = $('.yellow_bar .yellow_dot1').width() //22
    var backBarWidth = $('.progress_bar').width() //630
    var barObj = initBarObj()

    //初始化进度条中四个进度的长度信息，数值为每个进度条的长度/整个进度条的长度
    function initBarObj(){
      var barObj = {
        bar0:{width:140, preBarWidth: 0},
        bar1:{width:145},
        bar2:{width:147},
        bar3:{width:130}
      }
        for (var i = 1; i<=3; i++){
        barObj['bar' + i].preBarWidthRt = barObj['bar' + (i - 1)]['preBarWidth'] + barObj['bar' + (i - 1)]['width'] + dotWidth
      }
      return barObj
    }

    //传入用户积分数，显示黄色进度条
    function displayBar(userPoint){
      var i = pointArr.indexOf(userPoint)
      var length = pointArr.length
      resetYellowDot()

      if(i>=0){
        i = i + 1
        $('.yellow_bar').width((i/length) * backBarWidth - 15)
      }else{
        if (userPoint<pointArr[0]){
          i = 0
          var pointRatio = userPoint/pointArr[i]
          console.log(pointRatio)
          var width = pointRatio * barObj.bar0.width
          console.log(width)
          if(width < 10){
            var radiusWidth = window.Math.round(width/2)
            $('.yellow_bar').width(0)
            $('.yellow_bar .before').width(radiusWidth)
            $('.yellow_bar .after').css('right', 5-radiusWidth+'px').width(radiusWidth)
          }else{
            $('.yellow_bar').width(width - 9)
          }

        }else if(userPoint>pointArr[0] && userPoint<pointArr[1]){
          i = 1
          setYellowWidth(i, userPoint)
        }else if(userPoint>pointArr[1] && userPoint<pointArr[2]){
          i = 2
          setYellowWidth(i, userPoint)
        }else if(userPoint>pointArr[2] && userPoint<pointArr[3]){
          i = 3
          setYellowWidth(i, userPoint)
        }else if(userPoint>pointArr[3]){
          i = 4
          $('.yellow_bar').width((i/length) * backBarWidth)
        }else{
          i = 0
          $('.yellow_bar').width(0)
        }
      }

      for(var j=0; j <= i; j++){
        if (j === 0){continue}
        $('.yellow_dot'+j).addClass('active')
      }

    }

    //设置黄色进度条的长度
    function setYellowWidth(i, userPoint){
      var userSubtract = userPoint-pointArr[i-1]
      var defaultSubtract = pointArr[i] - pointArr[i-1]
      $('.yellow_bar').width(( barObj['bar'+i]['preBarWidth'] + userSubtract/defaultSubtract*barObj['bar'+i]['width']) * backBarWidth)
    }

    //让进度条上所有的点不显示
    function resetYellowDot(){
      for (var i = 1; i<=pointArr.length; i++){
        $('.yellow_dot'+i).removeClass('active')
      }
    }

    displayBar(100000)
</script>

</body>
</html>
